<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Air quality report - data exploration</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="air_quality_exploration_files/libs/clipboard/clipboard.min.js"></script>
<script src="air_quality_exploration_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="air_quality_exploration_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="air_quality_exploration_files/libs/quarto-html/popper.min.js"></script>
<script src="air_quality_exploration_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="air_quality_exploration_files/libs/quarto-html/anchor.min.js"></script>
<link href="air_quality_exploration_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="air_quality_exploration_files/libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="air_quality_exploration_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="air_quality_exploration_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="air_quality_exploration_files/libs/bootstrap/bootstrap-bb462d781dde1847d9e3ccf7736099dd.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Air quality report - data exploration</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>This is an exploratory analysis of air quality reports for Catalonia region, updated as of 14/05/2025. Data is downloaded from the <a href="https://administraciodigital.gencat.cat/ca/dades/dades-obertes/inici/index.html#googtrans(ca%7Cen)">open data portal</a> of Catalan Government (Generalitat de Catalunya), and includes hourly air quality metrics as well as geospatial information of the capture points.</p>
<p>The objective of this analysis is to find the biggest contributors to air pollution in Catalonia for the time period of the data. In order to get to this, both time evolution and geographic position will be taken into account.</p>
</section>
<section id="project-workflow" class="level2">
<h2 class="anchored" data-anchor-id="project-workflow">Project workflow</h2>
<p>The analysis is structured around a <a href="https://docs.kedro.org/en/stable/introduction/index.html">kedro</a> basic workflow, written in Python and uses the following tools / packages:</p>
<ul>
<li>uv (package dependency manager)</li>
<li>quarto (report renderer)</li>
<li>pandas (data wrangling)</li>
<li>altair (data visualization)</li>
<li>geopandas (geospatial analysis)</li>
</ul>
<p>The diagram of the different processes applied to the data is shown below:</p>
<ul>
<li>Data ingestion and type checking: reading the raw CSV file, converting to appropriate data types, saving “bronze” data to a parquet file.</li>
<li>Missing data handling: analyzing missing data and handling it properly (removing or imputing), saving “bronze” data to a parquet file.</li>
</ul>
<p>WIP –&gt; to be updated as the analysis progresses.</p>
<div id="fc3d437a" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print basic information about the environment and tools used</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>py_ver <span class="op">=</span> <span class="op">!</span>python <span class="op">--</span>version</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Python version (virtual environment):</span><span class="sc">{</span>py_ver[<span class="dv">0</span>]<span class="sc">}</span><span class="ch">\n\n</span><span class="ss">"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>kedro <span class="op">-</span>V</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="data-structure" class="level2">
<h2 class="anchored" data-anchor-id="data-structure">Data structure</h2>
<p>The raw data is a unique CSV file with the following columns and data types:</p>
<div id="99107f4b" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load kedro catalog from YAML</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> kedro.io <span class="im">import</span> KedroDataCatalog</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> yaml</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"../conf/base/catalog.yml"</span>, <span class="st">"r"</span>) <span class="im">as</span> f:</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    conf_catalog <span class="op">=</span> yaml.safe_load(f)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>catalog <span class="op">=</span> KedroDataCatalog.from_config(conf_catalog)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="ef999d82" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load raw data from the catalog</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>df_raw <span class="op">=</span> catalog.load(<span class="st">"air_quality_log"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>df_raw.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The contained data can be divided in the following categories:</p>
<ul>
<li>Identification: columns 0, 1</li>
<li>Time: column 2 (and partially columns 12-35)</li>
<li>Location: columns 6, 7, 8, 9, 10, 11, 36, 37, 38, 39 (empty)</li>
<li>Measurement info: columns 3, 4, 5, 12-35</li>
</ul>
<p>Data structure doesn’t follow a strict “row per measurement” lemma, as every row of the file contains 24 data measurements (hourly average per each day).</p>
<p>Some rework will have to be done for easier anaylisis, pivoting the data in order to have one row for each time measurement per station and per parameter.</p>
<p>Data types seem apropiate to the content. Once pivoted, however, new data types will have to be added, such as timestamp for the combined date + hour information. The geographic information, which is plain text or floats, will have to be converted for geospatial analysis. This will be done by converting the whole data type from a pandas normal DataFrame to a geopandas GeoDataFrame (which will retain all of its previous columns plus a ‘geometry’ column).</p>
<p>However, as the raw data contains 1.4M+ rows (and we will be expanding it even more), the first step will be to split the big dataframe into smaller chunks. Then each chunk will be processed separately and saved as a parquet file.</p>
<div id="38d3e38f" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivot the data and save as parquet</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> pivoting_raw_data(df_raw: pd.DataFrame) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    df_pivoted <span class="op">=</span> (</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>        df_raw</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        .drop(columns<span class="op">=</span>[<span class="st">"Georeferència"</span>])</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>        .melt(id_vars<span class="op">=</span>[<span class="st">"CODI EOI"</span>, <span class="st">"NOM ESTACIO"</span>, <span class="st">"DATA"</span>, <span class="st">"MAGNITUD"</span>, <span class="st">"CONTAMINANT"</span>, <span class="st">"UNITATS"</span>, <span class="st">"TIPUS ESTACIO"</span>, <span class="st">"AREA URBANA"</span>, </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"CODI INE"</span>, <span class="st">"MUNICIPI"</span>, <span class="st">"CODI COMARCA"</span>, <span class="st">"NOM COMARCA"</span>, <span class="st">"ALTITUD"</span>, <span class="st">"LATITUD"</span>, <span class="st">"LONGITUD"</span>],</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>        value_vars<span class="op">=</span>[<span class="st">"01h"</span>, <span class="st">"02h"</span>, <span class="st">"03h"</span>, <span class="st">"04h"</span>, <span class="st">"05h"</span>, <span class="st">"06h"</span>, <span class="st">"07h"</span>, <span class="st">"08h"</span>, <span class="st">"09h"</span>, <span class="st">"10h"</span>, <span class="st">"11h"</span>, <span class="st">"12h"</span>, <span class="st">"13h"</span>,</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">"14h"</span>, <span class="st">"15h"</span>, <span class="st">"16h"</span>, <span class="st">"17h"</span>, <span class="st">"18h"</span>, <span class="st">"19h"</span>, <span class="st">"20h"</span>, <span class="st">"21h"</span>, <span class="st">"22h"</span>, <span class="st">"23h"</span>, <span class="st">"24h"</span>],</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>        var_name<span class="op">=</span><span class="st">"HORA"</span>, value_name<span class="op">=</span><span class="st">"VALOR"</span>)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df_pivoted</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total number of rows: </span><span class="sc">{</span>df_raw<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>max_rows_per_chunk <span class="op">=</span> <span class="dv">350000</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>index <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, df_raw.shape[<span class="dv">0</span>], max_rows_per_chunk):</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    chunk <span class="op">=</span> df_raw.iloc[i:i<span class="op">+</span>max_rows_per_chunk,:]</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    pivoted_chunk <span class="op">=</span> pivoting_raw_data(chunk)</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    pivoted_chunk.to_parquet(<span class="ss">f"../data/02_intermediate/air_quality_bronze_</span><span class="sc">{</span>index<span class="sc">}</span><span class="ss">.parquet"</span>, engine<span class="op">=</span><span class="st">"pyarrow"</span>, partition_cols<span class="op">=</span>[<span class="st">"NOM COMARCA"</span>])</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    index <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="kw">del</span> df_raw  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>For simplicity, let’s work with only one of the chunks. We will use the first chunk for this purpose (newest data). Afterwards, all the steps applied to this chunk will be applied to the rest of them.</p>
<div id="a48808d2" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the first chunk of data.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>df_bronze <span class="op">=</span> pd.read_parquet(<span class="st">"../data/02_intermediate/air_quality_bronze_1.parquet"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="2b3aed1e" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the date and time columns to a single timestamp column.</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime, timedelta</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> transform_datetime(df_old: pd.DataFrame) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    df_old.loc[:, <span class="st">"HORA"</span>] <span class="op">=</span> df_old.loc[:, <span class="st">"HORA"</span>].<span class="bu">str</span>.replace(<span class="st">"h"</span>, <span class="st">""</span>).astype(<span class="bu">int</span>)<span class="op">-</span><span class="dv">1</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    df_new <span class="op">=</span> df_old.assign(</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>        DATA_HORA<span class="op">=</span><span class="kw">lambda</span> s: s.<span class="bu">apply</span>(</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>            <span class="kw">lambda</span> row: datetime.strptime(</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>                row.loc[<span class="st">"DATA"</span>] <span class="op">+</span> <span class="st">" "</span> <span class="op">+</span> <span class="bu">str</span>(row.loc[<span class="st">"HORA"</span>]) <span class="op">+</span> <span class="st">":00"</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>            , <span class="st">"</span><span class="sc">%d</span><span class="st">/%m/%Y %H:%M"</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>            ) <span class="op">+</span> timedelta(hours<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>        axis<span class="op">=</span><span class="dv">1</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    ).drop(columns<span class="op">=</span>[<span class="st">"DATA"</span>, <span class="st">"HORA"</span>])</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df_new</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>df_bronze <span class="op">=</span> transform_datetime(df_bronze)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="19470c1b" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a geodataframe with the geometry taken from the coordinates in "LATITUD" and "LONGITUD"</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shutil</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_geodataframe(df_new: pd.DataFrame) <span class="op">-&gt;</span> gpd.GeoDataFrame:</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    gdf_new <span class="op">=</span> gpd.GeoDataFrame(</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>        df_new, geometry<span class="op">=</span>gpd.points_from_xy(</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>            df_new.loc[:,<span class="st">"LATITUD"</span>], df_new.loc[:,<span class="st">"LONGITUD"</span>],crs<span class="op">=</span><span class="st">"EPSG:4326"</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    ).drop(columns<span class="op">=</span>[<span class="st">"LATITUD"</span>, <span class="st">"LONGITUD"</span>])</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> gdf_new</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>gdf_bronze <span class="op">=</span> create_geodataframe(df_bronze)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>gdf_bronze.head()</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>shutil.rmtree(<span class="st">"../data/02_intermediate/air_quality_bronze_1.parquet"</span>)</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>gdf_bronze.to_parquet(<span class="st">"../data/02_intermediate/air_quality_bronze_1.parquet"</span>, engine<span class="op">=</span><span class="st">"pyarrow"</span>)</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="kw">del</span> df_bronze</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now that it seems that the data has the correct format, let’s apply this functions to the whole dataset and override the previous bronze .parquet files.</p>
<div id="4f429d7c" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply transformations to all the chunks and overwrite .parquet bronze files</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>, index):</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    df_old <span class="op">=</span> pd.read_parquet(<span class="ss">f"../data/02_intermediate/air_quality_bronze_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">.parquet"</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    df_new <span class="op">=</span> transform_datetime(df_old)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    gdf_new <span class="op">=</span> create_geodataframe(df_new)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    shutil.rmtree(<span class="ss">f"../data/02_intermediate/air_quality_bronze_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">.parquet"</span>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    gdf_new.to_parquet(<span class="ss">f"../data/02_intermediate/air_quality_bronze_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">.parquet"</span>, engine<span class="op">=</span><span class="st">"pyarrow"</span>)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="kw">del</span> gdf_bronze</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="peek-of-the-data" class="level2">
<h2 class="anchored" data-anchor-id="peek-of-the-data">Peek of the data</h2>
<p>Let’s select a close-by station and plot a few air quality parameters to see how they look like.</p>
<div id="51a8e2b6" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select a station and some air quality magnitudes</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> altair <span class="im">as</span> alt</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>gdf_bronze <span class="op">=</span> gpd.read_parquet(<span class="st">"../data/02_intermediate/air_quality_bronze_1.parquet"</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>station <span class="op">=</span> <span class="st">"Barcelona (Eixample)"</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>magnitudes <span class="op">=</span> gdf_bronze.loc[gdf_bronze.loc[:,<span class="st">"NOM ESTACIO"</span>] <span class="op">==</span> station,<span class="st">"CONTAMINANT"</span>].unique()</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>closeby_station <span class="op">=</span> gdf_bronze.query(<span class="st">"`NOM ESTACIO` == @station"</span>).loc[:,[<span class="st">"DATA_HORA"</span>,<span class="st">"VALOR"</span>, <span class="st">"CONTAMINANT"</span>, <span class="st">"UNITATS"</span>]].sort_values(by<span class="op">=</span><span class="st">"DATA_HORA"</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>unit <span class="op">=</span> closeby_station.loc[:,<span class="st">"UNITATS"</span>].unique()[<span class="dv">0</span>]</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Chosen station: </span><span class="sc">{</span>station<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Available magnitudes: </span><span class="sc">{</span>magnitudes<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Chosen station: Barcelona (Eixample)
Available magnitudes: ['CO' 'SO2' 'O3' 'NO2' 'PM10' 'PM2.5' 'NO' 'NOX']</code></pre>
</div>
</div>
<div id="cac4cb38" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data of the latest 200 measurements for a random parameter</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>magnitude <span class="op">=</span> closeby_station.loc[:,<span class="st">"CONTAMINANT"</span>].sample(<span class="dv">1</span>).values[<span class="dv">0</span>]</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>unit <span class="op">=</span> closeby_station.query(<span class="st">"`CONTAMINANT` == @magnitude"</span>).loc[:,<span class="st">"UNITATS"</span>].values[<span class="dv">0</span>]</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>alt.Chart(closeby_station.query(<span class="st">"`CONTAMINANT` == @magnitude"</span>).tail(<span class="dv">200</span>)).mark_line().encode(</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>alt.X(<span class="st">"DATA_HORA:T"</span>, title<span class="op">=</span><span class="st">"Date"</span>),</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>alt.Y(<span class="st">"VALOR:Q"</span>, title<span class="op">=</span><span class="ss">f"Air Quality Parameter </span><span class="sc">{</span>magnitude<span class="sc">}</span><span class="ss"> [</span><span class="sc">{</span>unit<span class="sc">}</span><span class="ss">]"</span>),</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    tooltip<span class="op">=</span>[<span class="st">"DATA_HORA"</span>, <span class="st">"VALOR"</span>]</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="7">

<style>
  #altair-viz-bfe153c1c54145bd8b21e3cce550f395.vega-embed {
    width: 100%;
    display: flex;
  }

  #altair-viz-bfe153c1c54145bd8b21e3cce550f395.vega-embed details,
  #altair-viz-bfe153c1c54145bd8b21e3cce550f395.vega-embed details summary {
    position: relative;
  }
</style>
<div id="altair-viz-bfe153c1c54145bd8b21e3cce550f395"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-bfe153c1c54145bd8b21e3cce550f395") {
      outputDiv = document.getElementById("altair-viz-bfe153c1c54145bd8b21e3cce550f395");
    }

    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm/vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm/vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm/vega-lite@5.20.1?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm/vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      let deps = ["vega-embed"];
      require(deps, displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "5.20.1"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 300, "continuousHeight": 300}}, "data": {"name": "data-3046f56624d9854e1b9d8dcc2fa3e0e1"}, "mark": {"type": "line"}, "encoding": {"tooltip": [{"field": "DATA_HORA", "type": "temporal"}, {"field": "VALOR", "type": "quantitative"}], "x": {"field": "DATA_HORA", "title": "Date", "type": "temporal"}, "y": {"field": "VALOR", "title": "Air Quality Parameter NO [\u00b5g/m3]", "type": "quantitative"}}, "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json", "datasets": {"data-3046f56624d9854e1b9d8dcc2fa3e0e1": [{"DATA_HORA": "2025-05-06T17:00:00", "VALOR": 9.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-06T18:00:00", "VALOR": 9.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-06T19:00:00", "VALOR": 10.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-06T20:00:00", "VALOR": 8.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-06T21:00:00", "VALOR": 4.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-06T22:00:00", "VALOR": 2.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-06T23:00:00", "VALOR": 2.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-07T00:00:00", "VALOR": 1.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-07T01:00:00", "VALOR": 2.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-07T02:00:00", "VALOR": 1.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-07T03:00:00", "VALOR": 1.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-07T04:00:00", "VALOR": 1.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-07T05:00:00", "VALOR": 1.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-07T06:00:00", "VALOR": 2.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-07T07:00:00", "VALOR": 4.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-07T08:00:00", "VALOR": 8.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-07T09:00:00", "VALOR": 19.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-07T10:00:00", "VALOR": 14.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-07T11:00:00", "VALOR": 8.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-07T12:00:00", "VALOR": 4.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-07T13:00:00", "VALOR": 6.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-07T14:00:00", "VALOR": 8.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-07T15:00:00", "VALOR": 7.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-07T16:00:00", "VALOR": 7.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-07T17:00:00", "VALOR": 6.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-07T18:00:00", "VALOR": 8.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-07T19:00:00", "VALOR": 8.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-07T20:00:00", "VALOR": 6.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-07T21:00:00", "VALOR": 3.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-07T22:00:00", "VALOR": 5.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-07T23:00:00", "VALOR": 3.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-08T00:00:00", "VALOR": 1.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-08T01:00:00", "VALOR": 1.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-08T02:00:00", "VALOR": 1.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-08T03:00:00", "VALOR": 1.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-08T04:00:00", "VALOR": 1.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-08T05:00:00", "VALOR": 1.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-08T06:00:00", "VALOR": 1.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-08T07:00:00", "VALOR": 3.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-08T08:00:00", "VALOR": 9.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-08T09:00:00", "VALOR": 9.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-08T10:00:00", "VALOR": 25.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-08T11:00:00", "VALOR": 26.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-08T12:00:00", "VALOR": 21.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-08T13:00:00", "VALOR": 15.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-08T14:00:00", "VALOR": 11.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-08T15:00:00", "VALOR": 7.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-08T16:00:00", "VALOR": 5.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-08T17:00:00", "VALOR": 10.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-08T18:00:00", "VALOR": 5.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-08T19:00:00", "VALOR": 5.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-08T20:00:00", "VALOR": 4.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-08T21:00:00", "VALOR": 2.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-08T22:00:00", "VALOR": 2.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-08T23:00:00", "VALOR": 2.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-09T00:00:00", "VALOR": 2.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-09T01:00:00", "VALOR": 2.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-09T02:00:00", "VALOR": 1.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-09T03:00:00", "VALOR": 1.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-09T04:00:00", "VALOR": 1.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-09T05:00:00", "VALOR": 3.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-09T06:00:00", "VALOR": 2.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-09T07:00:00", "VALOR": 3.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-09T08:00:00", "VALOR": 7.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-09T09:00:00", "VALOR": 11.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-09T10:00:00", "VALOR": 15.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-09T11:00:00", "VALOR": 9.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-09T12:00:00", "VALOR": 8.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-09T13:00:00", "VALOR": 6.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-09T14:00:00", "VALOR": 9.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-09T15:00:00", "VALOR": 6.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-09T16:00:00", "VALOR": 7.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-09T17:00:00", "VALOR": 8.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-09T18:00:00", "VALOR": 4.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-09T19:00:00", "VALOR": 4.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-09T20:00:00", "VALOR": 6.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-09T21:00:00", "VALOR": 5.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-09T22:00:00", "VALOR": 4.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-09T23:00:00", "VALOR": 3.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-10T00:00:00", "VALOR": 2.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-10T01:00:00", "VALOR": 2.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-10T02:00:00", "VALOR": 2.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-10T03:00:00", "VALOR": 2.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-10T04:00:00", "VALOR": 1.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-10T05:00:00", "VALOR": 2.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-10T06:00:00", "VALOR": 2.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-10T07:00:00", "VALOR": 4.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-10T08:00:00", "VALOR": 5.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-10T09:00:00", "VALOR": 4.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-10T10:00:00", "VALOR": 3.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-10T11:00:00", "VALOR": 5.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-10T12:00:00", "VALOR": 4.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-10T13:00:00", "VALOR": 4.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-10T14:00:00", "VALOR": 5.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-10T15:00:00", "VALOR": 5.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-10T16:00:00", "VALOR": 4.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-10T17:00:00", "VALOR": 3.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-10T18:00:00", "VALOR": 4.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-10T19:00:00", "VALOR": 5.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-10T20:00:00", "VALOR": 6.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-10T21:00:00", "VALOR": 6.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-10T22:00:00", "VALOR": 4.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-10T23:00:00", "VALOR": 3.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-11T00:00:00", "VALOR": 2.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-11T01:00:00", "VALOR": 2.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-11T02:00:00", "VALOR": 1.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-11T03:00:00", "VALOR": 2.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-11T04:00:00", "VALOR": 1.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-11T05:00:00", "VALOR": 1.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-11T06:00:00", "VALOR": 1.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-11T07:00:00", "VALOR": 1.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-11T08:00:00", "VALOR": 2.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-11T09:00:00", "VALOR": 2.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-11T10:00:00", "VALOR": 3.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-11T11:00:00", "VALOR": 3.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-11T12:00:00", "VALOR": 4.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-11T13:00:00", "VALOR": 3.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-11T14:00:00", "VALOR": 6.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-11T15:00:00", "VALOR": 4.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-11T16:00:00", "VALOR": 3.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-11T17:00:00", "VALOR": 2.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-11T18:00:00", "VALOR": 2.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-11T19:00:00", "VALOR": 1.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-11T20:00:00", "VALOR": 2.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-11T21:00:00", "VALOR": 2.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-11T22:00:00", "VALOR": 2.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-11T23:00:00", "VALOR": 1.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-12T00:00:00", "VALOR": 2.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-12T01:00:00", "VALOR": 1.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-12T02:00:00", "VALOR": 1.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-12T03:00:00", "VALOR": 2.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-12T04:00:00", "VALOR": 2.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-12T05:00:00", "VALOR": 1.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-12T06:00:00", "VALOR": 2.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-12T07:00:00", "VALOR": 2.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-12T08:00:00", "VALOR": 7.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-12T09:00:00", "VALOR": 12.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-12T10:00:00", "VALOR": 15.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-12T11:00:00", "VALOR": 14.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-12T12:00:00", "VALOR": 25.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-12T13:00:00", "VALOR": 25.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-12T14:00:00", "VALOR": 16.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-12T15:00:00", "VALOR": 10.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-12T16:00:00", "VALOR": 9.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-12T17:00:00", "VALOR": 9.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-12T18:00:00", "VALOR": 9.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-12T19:00:00", "VALOR": 10.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-12T20:00:00", "VALOR": 9.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-12T21:00:00", "VALOR": 4.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-12T22:00:00", "VALOR": 4.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-12T23:00:00", "VALOR": 3.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-13T00:00:00", "VALOR": 2.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-13T01:00:00", "VALOR": 1.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-13T02:00:00", "VALOR": 1.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-13T03:00:00", "VALOR": 1.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-13T04:00:00", "VALOR": 1.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-13T05:00:00", "VALOR": 1.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-13T06:00:00", "VALOR": 1.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-13T07:00:00", "VALOR": 1.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-13T08:00:00", "VALOR": 12.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-13T09:00:00", "VALOR": 34.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-13T10:00:00", "VALOR": 55.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-13T11:00:00", "VALOR": 23.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-13T12:00:00", "VALOR": 10.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-13T13:00:00", "VALOR": 12.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-13T14:00:00", "VALOR": 9.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-13T15:00:00", "VALOR": 6.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-13T16:00:00", "VALOR": 7.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-13T17:00:00", "VALOR": 9.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-13T18:00:00", "VALOR": 7.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-13T19:00:00", "VALOR": 11.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-13T20:00:00", "VALOR": 5.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-13T21:00:00", "VALOR": 4.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-13T22:00:00", "VALOR": 3.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-13T23:00:00", "VALOR": 2.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-14T00:00:00", "VALOR": 7.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-14T01:00:00", "VALOR": 1.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-14T02:00:00", "VALOR": 1.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-14T03:00:00", "VALOR": 1.0, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-14T04:00:00", "VALOR": null, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-14T05:00:00", "VALOR": null, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-14T06:00:00", "VALOR": null, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-14T07:00:00", "VALOR": null, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-14T08:00:00", "VALOR": null, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-14T09:00:00", "VALOR": null, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-14T10:00:00", "VALOR": null, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-14T11:00:00", "VALOR": null, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-14T12:00:00", "VALOR": null, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-14T13:00:00", "VALOR": null, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-14T14:00:00", "VALOR": null, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-14T15:00:00", "VALOR": null, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-14T16:00:00", "VALOR": null, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-14T17:00:00", "VALOR": null, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-14T18:00:00", "VALOR": null, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-14T19:00:00", "VALOR": null, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-14T20:00:00", "VALOR": null, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-14T21:00:00", "VALOR": null, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-14T22:00:00", "VALOR": null, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-14T23:00:00", "VALOR": null, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}, {"DATA_HORA": "2025-05-15T00:00:00", "VALOR": null, "CONTAMINANT": "NO", "UNITATS": "\u00b5g/m3"}]}}, {"mode": "vega-lite"});
</script>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>